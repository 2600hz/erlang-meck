<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Meck by eproxus</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link href='http://fonts.googleapis.com/css?family=Days+One' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script type="text/javascript">
/* <![CDATA[ */
    (function() {
        var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
        s.type = 'text/javascript';
        s.async = true;
        s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
        t.parentNode.insertBefore(s, t);
    })();
/* ]]> */</script>

  </head>
  <body>

      <header>
        <h1>Meck</h1>
        <p>A mocking library for Erlang</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/eproxus/meck" class="button fork"><strong>View On GitHub</strong></a>

        <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;" href="http://eproxus.github.com/meck"></a>
<noscript><a href="http://flattr.com/thing/50105/Meck-a-mocking-library-for-Erlang" target="_blank">
        <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>

        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/eproxus/meck/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/eproxus/meck/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>meck</h1>

<p>A mocking library for Erlang.</p>

<h2>Introduction</h2>

<p>With meck you can easily mock modules in Erlang. You can also perform
some basic validations on the mocked modules, such as making sure no
unexpected exceptions occurred or looking at the call history.</p>

<h2>Features</h2>

<ul>
<li>Automatic renaming and restoration of original modules</li>
<li>Automatic backup and restore of cover data</li>
<li>Changing return values using sequences and loops of static values</li>
<li>Pass through: use functions from the original module</li>
<li>Mock is linked to the creating process (disable with <code>no_link</code>)</li>
<li>Complete call history showing calls, results and exceptions</li>
<li>Mocking of sticky modules (using the option <code>unstick</code>)</li>
<li>Throwing of expected exceptions that keeps the module valid</li>
</ul><h2>Examples</h2>

<p>Here's an example of using meck in the Erlang shell:</p>

<div class="highlight">
<pre><span class="go">Eshell V5.8.4  (abort with ^G)</span>
<span class="gp">1&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">dog</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">2&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">bark</span><span class="p">,</span> <span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s">"Woof!"</span> <span class="k">end</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">3&gt;</span> <span class="nn">dog</span><span class="p">:</span><span class="n">bark</span><span class="p">().</span>
<span class="go">"Woof!"</span>
<span class="gp">4&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">validate</span><span class="p">(</span><span class="n">dog</span><span class="p">).</span>
<span class="go">true</span>
<span class="gp">5&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">unload</span><span class="p">(</span><span class="n">dog</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">6&gt;</span> <span class="nn">dog</span><span class="p">:</span><span class="n">bark</span><span class="p">().</span>
<span class="gt">** exception error: undefined function dog:bark/0</span>
</pre>
</div>


<p>Exceptions can be anticipated by meck (resulting in validation still
passing). This is intended to be used to test code that can and should
handle certain exceptions indeed does take care of them:</p>

<div class="highlight">
<pre><span class="gp">5&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">meow</span><span class="p">,</span> <span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">exception</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">not_a_cat</span><span class="p">)</span> <span class="k">end</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">6&gt;</span> <span class="k">catch</span> <span class="nn">dog</span><span class="p">:</span><span class="n">meow</span><span class="p">().</span>
<span class="go">{'EXIT',{not_a_cat,[{meck,exception,2},</span>
<span class="go">                    {meck,exec,4},</span>
<span class="go">                    {dog,meow,[]},</span>
<span class="go">                    {erl_eval,do_apply,5},</span>
<span class="go">                    {erl_eval,expr,5},</span>
<span class="go">                    {shell,exprs,6},</span>
<span class="go">                    {shell,eval_exprs,6},</span>
<span class="go">                    {shell,eval_loop,3}]}}</span>
<span class="gp">7&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">validate</span><span class="p">(</span><span class="n">dog</span><span class="p">).</span>
<span class="go">true</span>
</pre>
</div>


<p>Normal Erlang exceptions result in a failed validation. The following
example is just to demonstrate the behavior, in real test code the
exception would normally come from the code under test (which should,
if not expected, invalidate the mocked module):</p>

<div class="highlight">
<pre><span class="gp">8&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">jump</span><span class="p">,</span> <span class="k">fun</span><span class="p">(</span><span class="nv">Height</span><span class="p">)</span> <span class="k">when</span> <span class="nv">Height</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">-&gt;</span>
<span class="go">                                  erlang:error(too_high);</span>
<span class="go">                             (Height) -&gt;</span>
<span class="go">                                  ok</span>
<span class="go">                          end).</span>
<span class="go">ok</span>
<span class="gp">9&gt;</span> <span class="nn">dog</span><span class="p">:</span><span class="n">jump</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">10&gt;</span> <span class="k">catch</span> <span class="nn">dog</span><span class="p">:</span><span class="n">jump</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span>
<span class="go">{'EXIT',{too_high,[{meck,exec,4},</span>
<span class="go">                   {dog,jump,[5]},</span>
<span class="go">                   {erl_eval,do_apply,5},</span>
<span class="go">                   {erl_eval,expr,5},</span>
<span class="go">                   {shell,exprs,6},</span>
<span class="go">                   {shell,eval_exprs,6},</span>
<span class="go">                   {shell,eval_loop,3}]}}</span>
<span class="gp">11&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">validate</span><span class="p">(</span><span class="n">dog</span><span class="p">).</span>
<span class="go">false</span>
</pre>
</div>


<p>Here's an example of using meck inside an EUnit test case:</p>

<div class="highlight">
<pre><span class="nf">my_test</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nn">meck</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">my_library_module</span><span class="p">),</span>
    <span class="nn">meck</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">my_library_module</span><span class="p">,</span> <span class="n">fib</span><span class="p">,</span> <span class="k">fun</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">21</span> <span class="k">end</span><span class="p">),</span>
    <span class="o">?</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="nn">code_under_test</span><span class="p">:</span><span class="n">run</span><span class="p">(</span><span class="n">fib</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span> <span class="c">% Uses my_library_module</span>
    <span class="o">?</span><span class="n">assert</span><span class="p">(</span><span class="nn">meck</span><span class="p">:</span><span class="n">validate</span><span class="p">(</span><span class="n">my_library_module</span><span class="p">)),</span>
    <span class="nn">meck</span><span class="p">:</span><span class="n">unload</span><span class="p">(</span><span class="n">my_library_module</span><span class="p">).</span>
</pre>
</div>


<p>Pass-through is used when the original functionality of a module
should be kept. When the option <code>passthrough</code> is used when calling
<code>new/2</code> all functions in the original module will be kept in the
mock. These can later be overridden by calling <code>expect/3</code> or
<code>expect/4</code>.</p>

<div class="highlight">
<pre><span class="go">Eshell V5.8.4  (abort with ^G)</span>
<span class="gp">1&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">[</span><span class="n">unstick</span><span class="p">,</span> <span class="n">passthrough</span><span class="p">]).</span>
<span class="go">ok</span>
<span class="gp">2&gt;</span> <span class="nn">string</span><span class="p">:</span><span class="n">strip</span><span class="p">(</span><span class="s">"  test  "</span><span class="p">).</span>
<span class="go">"test"</span>
</pre>
</div>


<p>It's also possible to pass calls to the original function allowing us
to override only a certain behavior of a function (this usage is
compatible with the <code>passthrough</code> option). <code>passthrough/1</code> will always
call the original function with the same name as the expect is 
defined in):</p>

<div class="highlight">
<pre><span class="go">Eshell V5.8.4  (abort with ^G)</span>
<span class="gp">1&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">[</span><span class="n">unstick</span><span class="p">]).</span>
<span class="go">ok</span>
<span class="gp">2&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="k">fun</span><span class="p">(</span><span class="nv">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">passthrough</span><span class="p">([</span><span class="nv">String</span><span class="p">])</span> <span class="k">end</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">3&gt;</span> <span class="nn">string</span><span class="p">:</span><span class="n">strip</span><span class="p">(</span><span class="s">"  test  "</span><span class="p">).</span>
<span class="go">"test"</span>
<span class="gp">4&gt;</span> <span class="nn">meck</span><span class="p">:</span><span class="n">unload</span><span class="p">(</span><span class="n">string</span><span class="p">).</span>
<span class="go">ok</span>
<span class="gp">5&gt;</span> <span class="nn">string</span><span class="p">:</span><span class="n">strip</span><span class="p">(</span><span class="s">"  test  "</span><span class="p">).</span>
<span class="go">"test"</span>
</pre>
</div>


<h2>Build</h2>

<p><a href="http://travis-ci.org/eproxus/meck"><img src="https://secure.travis-ci.org/eproxus/meck.png" alt="Build Status"></a></p>

<p>meck requires <a href="https://github.com/basho/rebar" title="Rebar - A build tool for Erlang">rebar</a> to build. To build meck, go to the meck
directory and simply type:</p>

<div class="highlight">
<pre>rebar compile
</pre>
</div>


<p>To make sure meck works on your platform, run the tests:</p>

<div class="highlight">
<pre>rebar eunit
</pre>
</div>


<p>Two things might seem alarming when running the tests:</p>

<ol>
<li>Warnings emitted by cover</li>
<li>En exception printed by SASL</li>
</ol><p>Both are expected due to the way Erlang currently prints errors. The
important line you should look for is <code>All XX tests passed</code>, if that
appears all is correct.</p>

<h2>Install</h2>

<p>To install meck permanently, use of <a href="http://erlagner.org/" title="Agner - Erlang Package Index &amp; Package Manager">Agner</a> is recommended:</p>

<div class="highlight">
<pre>agner install meck
</pre>
</div>


<p>If you want to install your own built version of meck add the ebin
directory to your Erlang code path or move the meck folder into your
release folder and make sure that folder is in your <code>ERL_LIBS</code>
environment variable.</p>

<h2>Contribute</h2>

<p>Patches are greatly appreciated!</p>

<p>Should you find yourself using meck and have issues, comments or
feedback please <a href="http://github.com/eproxus/meck/issues" title="meck issues">create an issue here on GitHub.</a></p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/eproxus">eproxus</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme based on work by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-336094-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
